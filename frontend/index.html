<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Melodia: VibeFX Quest</title>
    <link rel="stylesheet" href="/static/style.css" />
    <script src="https://cdn.jsdelivr.net/gh/mattdiamond/Recorderjs@master/dist/recorder.js"></script>
</head>

<body>

<!-- Landing Page -->
<div id="intro-page">
  <p>
    <strong>‡πÉ‡∏ô‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏ô‡πÅ‡∏´‡πà‡∏á <span style="color:#FFD700;">Melodia</span></strong> ‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì<br>
    ‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡∏±‡∏•‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå <strong>Harmony Crystal</strong> ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏°‡πÄ‡∏ß‡∏ó‡∏¢‡πå <strong>Silencio</strong> ‡∏õ‡∏•‡πâ‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏õ‡∏à‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏á‡∏±‡∏ô<br>
    ‡∏ú‡∏π‡πâ‡∏Å‡∏•‡πâ‡∏≤ (‡∏Ñ‡∏∏‡∏ì!) ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏ô‡πÅ‡∏´‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏•‡∏≤‡∏¢<br>
    ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° <strong>Sound Essence</strong> ‡πÅ‡∏•‡∏∞‡∏ü‡∏∑‡πâ‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏û‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡∏±‡∏•‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á<br><br>
    üßô‚Äç‚ôÇÔ∏è ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏£‡πà‡∏≤‡∏¢‡πÄ‡∏ß‡∏ó‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?
  </p>
  <button class="btn" onclick="window.location.href='/map'">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</button>
</div>


<!-- Effect Map Page -->
<div id="map-page" class="centered hidden">
  <h2>üéõ Explore Sound Zones</h2>
  <button class="btn" onclick="startRecording()">üéô Record Your Voice (5s)</button>
  <div id="effect-buttons" class="centered hidden">
    <div class="stage-btn" onclick="applyEffect('reverb')">üß± Reverb<br>"Resonance Canyon"</div>
    <div class="stage-btn" onclick="applyEffect('chorus')">‚õ™ Chorus<br>"Celestial Choir"</div>
    <div class="stage-btn" onclick="applyEffect('echo')">üï≥ Echo<br>"Whispering Cavern"</div>
    <div class="stage-btn" onclick="applyEffect('distortion')">üå© Distortion<br>"Storm Rift"</div>
  </div>
  <br>
  <audio id="player" controls class="hidden"></audio>
</div>

<!-- Recorder.js -->
<script src="https://cdn.jsdelivr.net/gh/mattdiamond/Recorderjs@master/dist/recorder.js"></script>
<script>
  let recorder, audioContext, recordedBlob = null;

  function startAdventure() {
    document.getElementById("intro-page").classList.add("hidden");
    document.getElementById("map-page").classList.remove("hidden");
  }

  async function startRecording() {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const input = audioContext.createMediaStreamSource(stream);
    recorder = new Recorder(input, { numChannels: 1 });

    recorder.record();
    console.log("üéô Recording started...");

    setTimeout(() => {
      recorder.stop();
      recorder.exportWAV(blob => {
        recordedBlob = blob;
        document.getElementById("effect-buttons").classList.remove("hidden");
        document.getElementById("player").classList.remove("hidden");
        const url = URL.createObjectURL(blob);
        document.getElementById("player").src = url;
      });
    }, 5000);
  }

  async function applyEffect(effect) {
    const formData = new FormData();
    formData.append("file", recordedBlob, "recording.wav");
    formData.append("effect", effect);

    const response = await fetch("/process-audio/", {
      method: "POST",
      body: formData
    });

    const processedBlob = await response.blob();
    const url = URL.createObjectURL(processedBlob);
    document.getElementById("player").src = url;
  }
</script>

</body>
</html>
